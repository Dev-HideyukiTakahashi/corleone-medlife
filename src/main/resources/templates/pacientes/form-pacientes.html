<!--
=========================================================
* * Black Dashboard - v1.0.1
=========================================================

* Product Page: https://www.creative-tim.com/product/black-dashboard
* Copyright 2019 Creative Tim (https://www.creative-tim.com)


* Coded by Creative Tim

=========================================================

* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
  <!--Fragmento Head-->
  <div th:replace="fragments/head :: head"></div>

  <body class="">
    <div class="wrapper">
      <!-- Sidebar Fragment -->
      <div th:replace="fragments/sidebar :: sidebar"></div>
      <div class="main-panel">
        <!-- Navbar Fragment -->
        <div th:replace="fragments/navbar :: navbar"></div>
        <!--Main-->
        <div class="content">
          <div class="row">
            <div class="card card-plain">
              <div class="card-header">
                <h4 class="card-title">Cadastro de Paciente</h4>
                <span
                  th:if="${erro}"
                  th:text="${erro}"
                  class="text-warning"
                ></span>
              </div>
              <div class="card-body mt-3">
                <form
                  th:action="@{/pacientes/salvar}"
                  method="post"
                  th:object="${paciente}"
                >
                  <div class="form-row">
                    <input th:field="*{id}" type="hidden" name="id" />
                    <div class="form-group col-md-4">
                      <label for="nome">Nome*</label>
                      <input
                        th:field="*{nome}"
                        autocomplete="off"
                        type="text"
                        class="form-control"
                        id="nome"
                        placeholder="nome"
                        name="nome"
                        th:errorclass="is-invalid"
                      />
                      <span class="invalid-feedback" th:errors="*{nome}"></span>
                    </div>
                    <div class="form-group col-md-2">
                      <label for="cpf">CPF*</label>
                      <input
                        th:field="*{cpf}"
                        oninput="mascaraCpf(this)"
                        autocomplete="off"
                        type="text"
                        class="form-control"
                        id="cpf"
                        placeholder="cpf"
                        name="cpf"
                        th:errorclass="is-invalid"
                      />
                      <span class="invalid-feedback" th:errors="*{cpf}"></span>
                    </div>

                    <div class="form-group col-md-1">
                      <label for="idade">Idade*</label>
                      <input
                        th:field="*{idade}"
                        autocomplete="off"
                        type="number"
                        class="form-control"
                        id="idade"
                        placeholder="idade"
                        name="idade"
                        th:errorclass="is-invalid"
                      />
                      <span
                        class="invalid-feedback"
                        th:errors="*{idade}"
                      ></span>
                    </div>
                    <div class="form-group col-md-5"></div>
                    <div class="form-group col-md-2">
                      <label for="telefone">Telefone*</label>
                      <input
                        th:field="*{telefone}"
                        autocomplete="off"
                        type="text"
                        class="form-control"
                        id="telefone"
                        placeholder="telefone"
                        name="telefone"
                        th:errorclass="is-invalid"
                      />
                      <span
                        class="invalid-feedback"
                        th:errors="*{telefone}"
                      ></span>
                    </div>
                    <div class="form-group col-md-3">
                      <label for="email">Email*</label>
                      <input
                        th:field="*{email}"
                        autocomplete="off"
                        type="email"
                        class="form-control"
                        id="email"
                        placeholder="email"
                        name="email"
                        th:errorclass="is-invalid"
                      />
                      <span
                        class="invalid-feedback"
                        th:errors="*{email}"
                      ></span>
                    </div>
                    <div class="form-group col-md-10"></div>
                    <div class="form-group col-md-2 ml-2">
                      <label>Sexo*</label>
                      <div class="col-sm-10 mt-0">
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="radio"
                            name="sexo"
                            id="masculino"
                            value="MASCULINO"
                            th:field="*{sexo}"
                            th:errorclass="is-invalid"
                          />
                          <label class="form-check-label" for="masculino">
                            MASCULINO
                          </label>
                        </div>
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="radio"
                            name="sexo"
                            id="feminino"
                            value="FEMININO"
                            th:field="*{sexo}"
                            th:errorclass="is-invalid"
                          />
                          <label class="form-check-label" for="feminino">
                            FEMININO
                          </label>
                          <span
                            class="invalid-feedback"
                            th:errors="*{sexo}"
                          ></span>
                        </div>
                      </div>
                      <br />
                    </div>

                    <div class="form-group col-md-2 ml-2">
                      <label for="data">Data de Nascimento*</label>
                      <input
                        required
                        autocomplete="off"
                        type="date"
                        class="form-control"
                        id="data"
                        name="dataNascimento"
                        th:field="*{dataNascimento}"
                      />
                    </div>

                    <div class="form-group col-md-7"></div>
                    <div class="form-group col-md-1">
                      <label for="cep">Cep</label>
                      <input
                        type="text"
                        class="form-control"
                        id="cep"
                        autocomplete="off"
                      />
                    </div>
                    <div class="form-group col-md-11"></div>
                    <div class="form-group col-md-3">
                      <label>Rua</label>
                      <input
                        th:field="*{rua}"
                        class="form-control"
                        autocomplete="off"
                        name="rua"
                        type="text"
                        id="rua"
                      />
                    </div>
                    <div class="form-group col-md-1">
                      <label>Número</label>
                      <input
                        th:field="*{numero}"
                        class="form-control"
                        autocomplete="off"
                        name="numero"
                        type="number"
                        id="numero"
                      />
                    </div>
                    <div class="form-group col-md-10"></div>
                    <div class="form-group col-md-3">
                      <label>Bairro</label>
                      <input
                        th:field="*{bairro}"
                        class="form-control"
                        autocomplete="off"
                        name="bairro"
                        type="text"
                        id="bairro"
                      />
                    </div>
                    <div class="form-group col-md-3">
                      <label>Cidade</label>
                      <input
                        th:field="*{cidade}"
                        class="form-control"
                        autocomplete="off"
                        name="cidade"
                        type="text"
                        id="cidade"
                      />
                    </div>
                  </div>

                  <button
                    type="submit"
                    class="btn btn-outline-success my-2 my-sm-0"
                  >
                    Salvar
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
        <!--End Main-->
        <!--Footer fragment-->
        <div th:replace="fragments/footer :: footer"></div>
      </div>
    </div>
    <!--Colortheme fragment-->
    <div th:replace="fragments/colortheme :: colortheme"></div>
    <!-- Adicionando JQuery -->
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <!--Mascara de cpf-->
    <script>
      function mascaraCpf(i) {
        var v = i.value;

        if (isNaN(v[v.length - 1])) {
          // impede entrar outro caractere que não seja número
          i.value = v.substring(0, v.length - 1);
          return;
        }

        i.setAttribute("maxlength", "14");
        if (v.length == 3 || v.length == 7) i.value += ".";
        if (v.length == 11) i.value += "-";
      }
    </script>

    <!--Mascara de telefone(Jquery mask)-->
    <script>
      $(document).ready(function () {
        var check_phone = true;

        $("#telefone").keyup(function (event) {
          var len = $(this).val().length;
          var val = $(this).val();

          console.log("Qtd of digits: " + len);
          console.log($(this).val());

          if (len < 1) {
            check_phone = true;
            console.log("Check phone reseted");
            $("#telefone").unmask();
          }

          if (check_phone && len >= 3) {
            /* sometimes Chrome does not log keyup when typed too fast */

            check_phone = false;

            if ($(this).val().substring(2, 3) == 9) {
              /* mobile numbers in Brazil starts with 9 */

              $("#telefone").mask(
                "(00) 00009-0000"
              ); /* either 8 or 9 digits phones */
              $(this).val(val);
              console.log("mobile");
            } else {
              $("#telefone").mask("(00) 0000-0000");
              $(this).val(val);
              console.log("landline");
            }
          }
        });
      });
    </script>

    <!-- Adicionando Javascript ViaCEP-->
    <script>
      $(document).ready(function () {
        function limpa_formulário_cep() {
          // Limpa valores do formulário de cep.
          $("#rua").val("");
          $("#bairro").val("");
          $("#cidade").val("");
          $("#uf").val("");
          $("#ibge").val("");
        }

        //Quando o campo cep perde o foco.
        $("#cep").blur(function () {
          //Nova variável "cep" somente com dígitos.
          var cep = $(this).val().replace(/\D/g, "");

          //Verifica se campo cep possui valor informado.
          if (cep != "") {
            //Expressão regular para validar o CEP.
            var validacep = /^[0-9]{8}$/;

            //Valida o formato do CEP.
            if (validacep.test(cep)) {
              //Preenche os campos com "..." enquanto consulta webservice.
              $("#rua").val("...");
              $("#bairro").val("...");
              $("#cidade").val("...");
              $("#uf").val("...");
              $("#ibge").val("...");

              //Consulta o webservice viacep.com.br/
              $.getJSON(
                "https://viacep.com.br/ws/" + cep + "/json/?callback=?",
                function (dados) {
                  if (!("erro" in dados)) {
                    //Atualiza os campos com os valores da consulta.
                    $("#rua").val(dados.logradouro);
                    $("#bairro").val(dados.bairro);
                    $("#cidade").val(dados.localidade);
                  } //end if.
                  else {
                    //CEP pesquisado não foi encontrado.
                    limpa_formulário_cep();
                    alert("CEP não encontrado.");
                  }
                }
              );
            } //end if.
            else {
              //cep é inválido.
              limpa_formulário_cep();
              alert("Formato de CEP inválido.");
            }
          } //end if.
          else {
            //cep sem valor, limpa formulário.
            limpa_formulário_cep();
          }
        });
      });
    </script>
    <!--Javascript fragment-->
    <div th:replace="fragments/javascript :: javascript"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.11/jquery.mask.min.js"></script>
  </body>
</html>
